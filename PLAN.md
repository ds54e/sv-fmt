# 改善計画

1. **wrap_multiline_blocks の精度向上**
   - トークンベースのセミコロン数ではなく、sv-parser の CST から制御構造 (`ConditionalStatement`, `LoopStatement`) の本体を解析する。
   - `StatementOrNull` を再帰的に辿り、`begin...end` 有無・文数を正確に把握してから自動挿入を判断する。
   - `case`/`casez` 等も対象に含めて、複雑なブロックでの誤挿入を防ぐ。

2. **コメント扱いの改善**
   - 行頭コメントにインデントだけを適用し、余計なスペースを付けない。
   - 行末コメントがある場合でも式とコメントの間に 1 つだけスペースを挿入する。
   - ブロックコメントの前後に空行を入れるなど、最低限のレイアウト調整を追加する。

3. **フォーマットルールの拡張**
   - `case` 内の `:` 位置揃えや `unique/priority case` の空行ルールなど、追加オプションを検討。
   - `package`/`class`/`interface` の宣言周りで空行やコメント保持を改善する。
   - `max_line_length` は現在チェックのみなので、範囲外の場合にメッセージを詳細化するなど使い勝手を上げる。

4. **設定とテストの拡充**
   - `sv-fmt.toml` のサンプルを README と同期させ、すべてのキーに説明を追加。
   - CLI テストに「複数ファイル＋ディレクトリ」「設定ありの --check」「行長違反」のケースを加える。
   - フォーマット済み/未フォーマットの SystemVerilog フィクスチャを増やし、代表セクションを網羅する。
